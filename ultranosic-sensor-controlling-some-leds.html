<!DOCTYPE html><html lang="es"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Ultrasonic sensor controlling some LEDs - random[ ] - arquitectura y fabricación digital</title><meta name="robots" content="index, follow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://dhaslock.github.io/randomarq/ultranosic-sensor-controlling-some-leds.html"><link rel="amphtml" href="https://dhaslock.github.io/randomarq/amp/ultranosic-sensor-controlling-some-leds.html"><link type="application/atom+xml" rel="alternate" href="https://dhaslock.github.io/randomarq/feed.xml"><meta property="og:title" content="Ultrasonic sensor controlling some LEDs"><meta property="og:image" content="https://dhaslock.github.io/randomarq/media/posts/1/featured.jpg"><meta property="og:site_name" content="random[ ] - arquitectura y fabricación digital"><meta property="og:description" content="In this exercise we'll be using a ultrasonic HC-SR04 sensor to control some LEDs as a prototype idea for further elements to be controled upon&hellip;"><meta property="og:url" content="https://dhaslock.github.io/randomarq/ultranosic-sensor-controlling-some-leds.html"><meta property="og:type" content="article"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family= PT+Serif:400,700|Muli:400,600" rel="stylesheet"><link rel="stylesheet" href="https://dhaslock.github.io/randomarq/assets/css/style.css?v=f0bad53ff3c0dc057707972ece4af300"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://dhaslock.github.io/randomarq/ultranosic-sensor-controlling-some-leds.html"},"headline":"Ultrasonic sensor controlling some LEDs","datePublished":"2017-11-14T11:16","dateModified":"2018-10-13T13:16","image":{"@type":"ImageObject","url":"https://dhaslock.github.io/randomarq/media/posts/1/featured.jpg","height":1000,"width":1000},"description":"In this exercise we'll be using a ultrasonic HC-SR04 sensor to control some LEDs as a prototype idea for further elements to be controled upon&hellip;","author":{"@type":"Person","name":"english"},"publisher":{"@type":"Organization","name":"david serrano"}}</script><script async src="https://dhaslock.github.io/randomarq/assets/js/lazysizes.min.js?v=3150bf538edc0788afd7c673a0c5dfee"></script><style></style></head><body><div class="container"><header class="js-top is-sticky"><a class="logo" href="https://dhaslock.github.io/randomarq">random[ ] - arquitectura y fabricación digital</a><div class="top"><nav class="navbar js-navbar"><button class="navbar__toggle js-navbar__toggle" aria-expanded="false">Menu</button><ul class="navbar__menu"><li class="has-submenu"><span>random[es]</span><ul class="navbar__submenu"><li><a href="https://dhaslock.github.io/randomarq/random-arquitectura-y-fabricacion-digital.html" target="_self">random[arq]</a></li><li><span>Consultoría BIM</span></li><li><span>Formación</span></li><li><span>Contacto</span></li></ul></li><li class="has-submenu"><span>random[en]</span><ul class="navbar__submenu"><li><a href="https://dhaslock.github.io/randomarq/random-arquitectura-y-fabricacion-digital-copy.html" target="_self">about us</a></li><li><span>contact</span></li></ul></li></ul></nav></div></header><main class="u-cutting"><article class="post"><div class="post__featured-image post__image--full"><img class="lazyload" src="https://dhaslock.github.io/randomarq/media/posts/1/responsive/featured-xs.jpg" data-srcset="https://dhaslock.github.io/randomarq/media/posts/1/responsive/featured-xs.jpg 300w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/featured-sm.jpg 480w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/featured-md.jpg 768w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/featured-lg.jpg 1024w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/featured-xl.jpg 1360w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/featured-2xl.jpg 1600w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/featured-3xl.jpg 2560w" data-sizes="auto" height="1000" width="1000" alt=""></div><header class="post__header"><h1>Ultrasonic sensor controlling some LEDs</h1></header><div class="post__entry"><p>In this exercise we'll be using a ultrasonic HC-SR04 sensor to control some LEDs as a prototype idea for further elements to be controled upon the same concept.</p><p>In this case, we're going to simulate that we have some kind of a "gate" of light, consisting on 4 LEDS, two of wich will be turned off when something (or somebody) approaches to less than 30 cm of them.</p><p>The problem that we have in order to program our arduinos to work with this ultrasonic sensor, is that firefly doesn't have any tool to make it work. So we'll have to use a workaround. We'll use a handler and after programming the rest of the elements, we'll use the "code generator" component on firefly to save the code. Afterwards, with the arduino IDE, we'll modify the code to add the lines changing the handler for the sensor values.</p><p>We'll start by opening grasshopper and inserting the first components of firefly to check the ports avaliable and to open the port where our arduino is connected.</p><figure class="post__image post__image--center"><img class="lazyload" src="https://dhaslock.github.io/randomarq/media/posts/1/responsive/01-xs.png" data-sizes="auto" data-srcset="https://dhaslock.github.io/randomarq/media/posts/1/responsive/01-xs.png 300w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/01-sm.png 480w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/01-md.png 768w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/01-lg.png 1024w" alt="01" width="1276" height="559"><figcaption>check the ports avaliable first</figcaption></figure><figure class="post__image post__image--center"><img class="lazyload" src="https://dhaslock.github.io/randomarq/media/posts/1/responsive/02-xs.png" data-sizes="auto" data-srcset="https://dhaslock.github.io/randomarq/media/posts/1/responsive/02-xs.png 300w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/02-sm.png 480w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/02-md.png 768w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/02-lg.png 1024w" alt="" width="1276" height="559"><figcaption>Open the port where you have your arduino connected</figcaption></figure><p>After inserting a "Uno Read" component, we attach a "number" component to the Analog Pin 0 output. This will serve us later as a handler on the code, that we'll have to substitute with the value input from the ultrasonic sensor. </p><figure class="post__image post__image--center"><img class="lazyload" src="https://dhaslock.github.io/randomarq/media/posts/1/responsive/03-xs.png" data-sizes="auto" data-srcset="https://dhaslock.github.io/randomarq/media/posts/1/responsive/03-xs.png 300w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/03-sm.png 480w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/03-md.png 768w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/03-lg.png 1024w" alt="" width="1276" height="559"><figcaption>just get the output from APin0</figcaption></figure><p>The value that we will get from the sensor, will be pased to a "larger than" component, to check if the distance detected is bigger than a value that we'll set up as the trigger for the lights. With this code, if the distance detected by the sensor is bigger than the one selected, we'll get a "true" - so the inputs connected will be getting a digital true - and the leds connected on those pins will be on. If the distance is smalles, it will return a "false" and the leds will go off. </p><p>Add a "Uno Write" component to the canvas, and set up four digital inputs, two of them connected to a "1" state, so will be always on, and another two connected to the "larger than" output. In this example, we'll be using pins 8 and 11 as "always on", and pins 9 and 10 as controlled by the ultrasonic sensor.</p><figure class="post__image post__image--center"><img class="lazyload" src="https://dhaslock.github.io/randomarq/media/posts/1/responsive/04-xs.png" data-sizes="auto" data-srcset="https://dhaslock.github.io/randomarq/media/posts/1/responsive/04-xs.png 300w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/04-sm.png 480w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/04-md.png 768w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/04-lg.png 1024w" alt="" width="1276" height="559"><figcaption>Use a "larger than" component to set the rule for on and off for the leds selected</figcaption></figure><figure class="post__image post__image--center"><img class="lazyload" src="https://dhaslock.github.io/randomarq/media/posts/1/responsive/05-xs.png" data-sizes="auto" data-srcset="https://dhaslock.github.io/randomarq/media/posts/1/responsive/05-xs.png 300w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/05-sm.png 480w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/05-md.png 768w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/05-lg.png 1024w" alt="" width="1276" height="559"><figcaption>Setup a "Uno write" with four digital outputs, two set to 1 (always one) and two connected to the previous component</figcaption></figure><p>Once we have our snippet of code configured, add to the canvas a "Code Generator" component, and connect the input with the "out" output from the "Uno Write", and set up a path for the folder with the arduino code to be saved in in the "path" input. If you connect a panel to the output of the component, you should be seeing the arduino code generated.</p><figure class="post__image post__image--center"><img class="lazyload" src="https://dhaslock.github.io/randomarq/media/posts/1/responsive/06-xs.png" data-sizes="auto" data-srcset="https://dhaslock.github.io/randomarq/media/posts/1/responsive/06-xs.png 300w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/06-sm.png 480w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/06-md.png 768w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/06-lg.png 1024w" alt="" width="1276" height="559"><figcaption>Connect the "code generator" and get the arduino code.</figcaption></figure><figure class="post__image post__image--center"><img class="lazyload" src="https://dhaslock.github.io/randomarq/media/posts/1/responsive/07-xs.png" data-sizes="auto" data-srcset="https://dhaslock.github.io/randomarq/media/posts/1/responsive/07-xs.png 300w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/07-sm.png 480w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/07-md.png 768w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/07-lg.png 1024w" alt="" width="4152" height="2896"><figcaption>Definición completa. <a title="DESCARGAR ARCHIVO GH" href="https://www.dropbox.com/s/dy3vshj0u0pr8bd/ultrasonic.gh?dl=0" target="_blank" rel="noopener noreferrer">DESCARGAR ARCHIVO GH</a></figcaption></figure><p>At this point, in the folder that you defined, you should have two files, one with the name of the folder and extension .ino, and another one called Ffcasts.h. If this is the case, you can already close grasshopper and Rhino, we've finished our programming with it. If you dont have both files, check the grasshopper definition, that everything is connected the right way and that the port is open and the components working.</p><hr><p>Now, we have to import in the arduino IDE the library needed to use the ultrasonic sensor. You can find online some libraries, in this excersise we'll be using one called "Ultrasonic" developed by Erick Simoes. You can download the library in .zip format from the github page (<a href="https://github.com/ErickSimoes/Ultrasonic">https://github.com/ErickSimoes/Ultrasonic</a>) where you can find a lot of information about it, or <a href="https://github.com/ErickSimoes/Ultrasonic/archive/v1.0.1.zip" target="_blank" rel="noopener noreferrer">you can download the file directly HERE</a>.</p><p>To import the library, open the Arduino IDE, and follow the next steps:</p><ul><li>Click in Sketch &gt; Include library &gt; Add .ZIP library</li><li>Navigate to the .zip file's location and open it</li><li>Return to the sketch &gt; include library menu and now you should see the library at the bottom of the drop-down menu</li></ul><p>And now, we can open our code and modify it to use the sensor. Open on the Arduino IDE the file with the .ino extension created by grasshopper. you should see something like this:</p><pre class="msg--highlight msg msg--info"><code>/*</code><br><code>Firefly Code Generator by Andy Payne</code><br><code>Copyright 2011 All Rights Reserved</code><br><code>Code Generated on 11/14/2017 10:12:19</code><br><code>Special thanks to Panagiotis Michalatos.</code><br><code>For more information visit: www.fireflyexperiments.com</code><br><code>*/</code><br><br><code>#include "FFCasts.h"</code><br><br><code>//******************* Begin Function Definitions *******************</code><br><br><code>//Larger_Than_Or_Equal: Tests if A is larger than or equal to B.</code><br><code>boolean Larger_Than_Or_Equal(double _v1, double _v2) {</code><br><code> boolean result;</code><br><code> if(_v1 &gt;= _v2) result = true;</code><br><code> else result = false;</code><br><code> return result;</code><br><code>}</code><br><br><code>//******************** End Function Definitions ********************</code><br><br><code>void setup() {</code><br><code> pinMode(11, OUTPUT);</code><br><code> pinMode(10, OUTPUT);</code><br><code> pinMode(9, OUTPUT);</code><br><code> pinMode(8, OUTPUT);</code><br><code>}</code><br><br><code>void loop() {</code><br><code> int APin0 = analogRead(0);</code><br><code> digitalWrite(11, 1);</code><br><code> digitalWrite(10, Larger_Than_Or_Equal((double)(APin0),30.0));</code><br><code> digitalWrite(9, Larger_Than_Or_Equal((double)(APin0),30.0));</code><br><code> digitalWrite(8, 1);</code><br><code>} </code></pre><p>Now, go to File &gt; Examples &gt; Ultrasonic (it will be at the bottom) and select the "UltrasonicSimple" sketch. It will open in a new window with an example of how to use the library. It will look like this:</p><p class="msg msg--info"><br><code>#include &lt;Ultrasonic.h&gt;</code><br><br><code>Ultrasonic Ultrasonic(12, 13);</code><br><br><code>void setup() {</code><br><code>Serial.begin(9600);</code><br><code>}</code><br><br><code>void loop() {</code><br><code>Serial.print("Distance in CM: ");</code><br><code>// Pass INC as a parameter to get the distance in inches</code><br><code>Serial.println(Ultrasonic.distanceRead());</code><br><code>delay(1000);</code><br><code>}</code></p><p>With this example, we can see how it works and how do we have to modify our code to use the sensor (with this library, by default, the sensor will be using pin12 as the trigger and pin 13 as the echo receiver. So well use the same on our design).</p><p>We will copy on each section of our code the corresponding code from the example, and taking a look to the code, we can see that the distance from the sensor comes throug the command <em>"Ultrasonic.distanceRead()"</em>, so we will change the value of the variable APin0 that we used as a handler, for that command. We will end with a piece of code like this (in bold, the additions and modification over the original code):</p><p class="msg msg--info"><code>#include "FFCasts.h"</code><br><strong><code>#include &lt;Ultrasonic.h&gt;</code></strong><br><strong><code>Ultrasonic Ultrasonic(12, 13);</code></strong><br><br><code>//******************* Begin Function Definitions *******************</code><br><br><code>//Larger_Than_Or_Equal: Tests if A is larger than or equal to B.</code><br><code>boolean Larger_Than_Or_Equal(double _v1, double _v2) {</code><br><code>boolean result;</code><br><code>if(_v1 &gt;= _v2) result = true;</code><br><code>else result = false;</code><br><code>return result;</code><br><code>}</code><br><br><code>//******************** End Function Definitions ********************</code><br><br><code>void setup() {</code><br><strong><code>Serial.begin(9600);</code></strong><br><code>pinMode(11, OUTPUT);</code><br><code>pinMode(10, OUTPUT);</code><br><code>pinMode(9, OUTPUT);</code><br><code>pinMode(8, OUTPUT);</code><br><code>}</code><br><br><code>void loop() {</code><br><strong><code>Serial.print("Distance in CM: ");</code></strong><br><strong><code>Serial.println(Ultrasonic.distanceRead());</code></strong><br><code>int APin0 = <strong>Ultrasonic.distanceRead()</strong>;</code><br><code>digitalWrite(11, 1);</code><br><code>digitalWrite(10, Larger_Than_Or_Equal((double)(APin0),30.0));</code><br><code>digitalWrite(9, Larger_Than_Or_Equal((double)(APin0),30.0));</code><br><code>digitalWrite(8, 1);</code><br><code>delay(1000);</code><br><code>}</code></p><figure class="post__video">Now that we have our code modified, we can verify it and if everything is correct, upload the sketch to the arduino board. The leds will go on, and the sensor will be reading the distance in front of it and if something comes in front to a distance less that the one specified (in this instance, 30 cm), the two leds on the middle will go off. </figure><p>You can check the distance detected by the sensor, if you go to the arduino IDE and press the button on the top right to open the serial monitor. A new window will appear where it will be printed the distance detected by the sensor.</p><p>Here you can see a video showing this sketch at work:</p><figure class="post__video"><iframe class="lazyload" width="560" height="314" data-src="https://www.youtube.com/embed/VV3lDb4nv60" allowfullscreen="allowfullscreen" data-mce-fragment="1"></iframe></figure><p>Here you can see how you have to connect the sensor to the arduino:</p><figure class="post__image--center"><img class="lazyload" src="https://dhaslock.github.io/randomarq/media/posts/1/responsive/hc-sr04-with-arduino-xs.jpg" data-sizes="auto" data-srcset="https://dhaslock.github.io/randomarq/media/posts/1/responsive/hc-sr04-with-arduino-xs.jpg 300w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/hc-sr04-with-arduino-sm.jpg 480w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/hc-sr04-with-arduino-md.jpg 768w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/hc-sr04-with-arduino-lg.jpg 1024w" alt="" width="621" height="475"></figure>And here you can see the schematics of all the rig:<p></p><p><img class="lazyload" src="https://dhaslock.github.io/randomarq/media/posts/1/responsive/rig-xs.jpg" data-sizes="auto" data-srcset="https://dhaslock.github.io/randomarq/media/posts/1/responsive/rig-xs.jpg 300w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/rig-sm.jpg 480w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/rig-md.jpg 768w ,https://dhaslock.github.io/randomarq/media/posts/1/responsive/rig-lg.jpg 1024w" alt="" width="2646" height="1698"></p><p> </p></div></article></main><footer class="footer"><div class="footer__copyright">(-:</div></footer></div><script defer="defer" src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha256-k2WSCIexGzOj3Euiig+TlR8gA0EmPjuc79OEeY5L45g=" crossorigin="anonymous"></script><script defer="defer" src="https://dhaslock.github.io/randomarq/assets/js/scripts.min.js?v=5977caa3bd6c30eab5c559ded3288d58"></script></body></html>